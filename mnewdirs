#!/usr/bin/perl
##
# find maildirs with new messages by default spit out lines like this:
#     dir count
# in this form dir will have /new at the end if the -n option is
# specified, we instead spit out:
#     maildir
# which is just dirname $dir

use strict;
use warnings;
use File::Basename;
use File::Find;
use Getopt::Std;

our %newdirs = ();
our %opts;

sub check {
	$File::Find::name =~ /\/new\/\d+\.\d+_\d+.*$/ &&
	    $newdirs{$File::Find::dir}++;
}

getopts('n',\%opts);
find(\&check, $ENV{"HOME"}."/mail");
our $fmt = $opts{'n'} ? "%s\n" : "%s %d\n";
foreach (sort keys %newdirs) {
	my @out = ($opts{'n'} ? dirname($_) : $_);
	push(@out, $newdirs{$_}) unless $opts{'n'};
	printf($fmt,@out);
}

##
# Local variables:
# mode: perl
# tab-width: 8
# perl-indent-level: 8
# perl-continued-statement-offset: 4
# indent-tabs-mode: t
# comment-column: 40
# End:
##
